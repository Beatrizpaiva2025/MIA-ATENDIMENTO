{% extends "admin_base.html" %}

{% block title %}AI Training - MIA Customer Service{% endblock %}

{% block content %}
<style>
    .card { margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .card-header { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 18px 24px; }
    .card-header h2 { color: white; margin: 0; font-size: 1.3rem; font-weight: 700; }
    .form-group { margin-bottom: 20px; }
    .form-group label { font-weight: 600; color: #1e3a8a; margin-bottom: 8px; display: block; }
    .form-control, .form-select { border: 2px solid #e2e8f0; border-radius: 8px; padding: 10px 15px; width: 100%; }
    .form-control:focus { border-color: #3b82f6; outline: none; }
    .btn-primary { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); border: none; padding: 10px 24px; font-weight: 600; border-radius: 8px; color: white; cursor: pointer; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3); }
    .btn-warning { background: #f59e0b; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    .btn-danger { background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    .knowledge-item, .faq-item { background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
</style>

<!-- Personality Configuration -->
<div class="card">
    <div class="card-header">
        <h2><i class="bi bi-person-gear"></i> AI Personality</h2>
    </div>
    <div class="card-body">
        <form id="personalityForm">
            <div class="form-group">
                <label>Tone</label>
                <select class="form-select" id="tone" name="tone">
                    <option value="professional">Professional</option>
                    <option value="friendly">Friendly</option>
                    <option value="formal">Formal</option>
                </select>
            </div>
            <div class="form-group">
                <label>Main Goals</label>
                <textarea class="form-control" id="goals" name="goals" rows="3" placeholder="What are the assistant's main objectives?"></textarea>
            </div>
            <div class="form-group">
                <label>Restrictions</label>
                <textarea class="form-control" id="restrictions" name="restrictions" rows="3" placeholder="What the assistant should NOT do?"></textarea>
            </div>
            <button type="submit" class="btn-primary">
                <i class="bi bi-save"></i> Save Personality
            </button>
        </form>
    </div>
</div>

<!-- Knowledge Base -->
<div class="card">
    <div class="card-header">
        <h2><i class="bi bi-book"></i> Knowledge Base</h2>
    </div>
    <div class="card-body">
        <form id="knowledgeForm">
            <div class="form-group">
                <label>Category</label>
                <input type="text" class="form-control" id="kb_category" name="category" placeholder="E.g.: Translation Services">
            </div>
            <div class="form-group">
                <label>Title</label>
                <input type="text" class="form-control" id="kb_title" name="title" placeholder="E.g.: What is sworn translation?">
            </div>
            <div class="form-group">
                <label>Content</label>
                <textarea class="form-control" id="kb_content" name="content" rows="4" placeholder="Detailed information..."></textarea>
            </div>
            <button type="submit" class="btn-primary">
                <i class="bi bi-plus-circle"></i> Add to Knowledge Base
            </button>
        </form>
        
        <div id="knowledgeList" style="margin-top: 20px;"></div>
    </div>
</div>

<!-- FAQ -->
<div class="card">
    <div class="card-header">
        <h2><i class="bi bi-question-circle"></i> Frequently Asked Questions</h2>
    </div>
    <div class="card-body">
        <form id="faqForm">
            <div class="form-group">
                <label>Question</label>
                <input type="text" class="form-control" id="faq_question" name="question" placeholder="E.g.: What are your business hours?">
            </div>
            <div class="form-group">
                <label>Answer</label>
                <textarea class="form-control" id="faq_answer" name="answer" rows="3" placeholder="Detailed answer..."></textarea>
            </div>
            <button type="submit" class="btn-primary">
                <i class="bi bi-plus-circle"></i> Add FAQ
            </button>
        </form>
        
        <div id="faqList" style="margin-top: 20px;"></div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Save Personality
document.getElementById('personalityForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const tone = document.getElementById('tone').value;
    const goals = document.getElementById('goals').value;
    const restrictions = document.getElementById('restrictions').value;
    
    const personality = {
        tone: tone,
        goals: goals,
        restrictions: restrictions
    };
    
    try {
        const response = await fetch('/admin/config/personality', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ personality: JSON.stringify(personality) })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Personality saved successfully!', 'success');
        } else {
            showNotification('Error saving personality', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Error connecting to server', 'error');
    }
});

// Add Knowledge
document.getElementById('knowledgeForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const category = document.getElementById('kb_category').value;
    const title = document.getElementById('kb_title').value;
    const content = document.getElementById('kb_content').value;
    
    if (!category || !title || !content) {
        showNotification('Fill in all fields', 'warning');
        return;
    }
    
    try {
        const response = await fetch('/admin/knowledge/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ category, title, content })
        });
        
        if (response.ok) {
            showNotification('Knowledge added successfully!', 'success');
            document.getElementById('knowledgeForm').reset();
            loadKnowledge();
        } else {
            showNotification('Error adding knowledge', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Error connecting to server', 'error');
    }
});

// Add FAQ
document.getElementById('faqForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const question = document.getElementById('faq_question').value;
    const answer = document.getElementById('faq_answer').value;
    
    if (!question || !answer) {
        showNotification('Fill in all fields', 'warning');
        return;
    }
    
    try {
        const response = await fetch('/admin/faq/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question, answer })
        });
        
        if (response.ok) {
            showNotification('FAQ added successfully!', 'success');
            document.getElementById('faqForm').reset();
            loadFAQs();
        } else {
            showNotification('Error adding FAQ', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('Error connecting to server', 'error');
    }
});

// Load Knowledge
async function loadKnowledge() {
    // Placeholder for loading knowledge items
    document.getElementById('knowledgeList').innerHTML = '<p style="color: #64748b; font-style: italic;">Knowledge items will be displayed here</p>';
}

// Load FAQs
async function loadFAQs() {
    // Placeholder for loading FAQ items
    document.getElementById('faqList').innerHTML = '<p style="color: #64748b; font-style: italic;">FAQ items will be displayed here</p>';
}

// Show notification
function showNotification(message, type) {
    const colors = {
        success: '#10b981',
        warning: '#f59e0b',
        error: '#ef4444'
    };
    
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${colors[type]};
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 9999;
        font-weight: 600;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => notification.remove(), 3000);
}

// Load on page load
document.addEventListener('DOMContentLoaded', function() {
    loadKnowledge();
    loadFAQs();
});
</script>
{% endblock %}
