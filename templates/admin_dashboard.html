{% extends "admin_base.html" %}

{% block title %}Dashboard - MIA Bot{% endblock %}

{% block page_title %}Dashboard{% endblock %}
{% block page_subtitle %}Vis√£o geral do sistema de atendimento{% endblock %}

{% block content %}
{% if error %}
<div class="card" style="border-left: 4px solid var(--danger); background: rgba(220, 53, 69, 0.05);">
    <div class="card-body">
        <h3 style="color: var(--danger);">‚ùå Erro</h3>
        <p style="margin: 0;">{{ error }}</p>
    </div>
</div>
{% else %}

<!-- Estat√≠sticas Principais -->
<div class="stats-grid">
    <div class="stat-card">
        <h3>Total de Conversas</h3>
        <div class="stat-value">{{ stats.total_conversas or 0 }}</div>
        <i class="fas fa-comments stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <h3>Leads Capturados</h3>
        <div class="stat-value">{{ stats.total_leads or 0 }}</div>
        <i class="fas fa-users stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <h3>Documentos Analisados</h3>
        <div class="stat-value">{{ stats.total_documentos or 0 }}</div>
        <i class="fas fa-file-alt stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <h3>Transfer√™ncias Pendentes</h3>
        <div class="stat-value">{{ stats.transferencias_pendentes or 0 }}</div>
        <i class="fas fa-exchange-alt stat-icon"></i>
    </div>
</div>

<!-- Conversas por Canal -->
<div class="card">
    <div class="card-header">
        <h2>üìä Conversas por Canal (√öltimos 7 dias)</h2>
        <p>Distribui√ß√£o de atendimentos por plataforma</p>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
            <div style="text-align: center; padding: 24px; background: var(--gray-50); border-radius: 8px;">
                <i class="fab fa-whatsapp" style="font-size: 3rem; color: #25D366; margin-bottom: 12px;"></i>
                <h3 style="color: var(--legacy-navy); font-size: 2rem; margin-bottom: 4px;">{{ stats.conversas_whatsapp or 0 }}</h3>
                <p style="color: var(--gray-500); margin: 0;">WhatsApp</p>
            </div>
            
            <div style="text-align: center; padding: 24px; background: var(--gray-50); border-radius: 8px;">
                <i class="fab fa-instagram" style="font-size: 3rem; color: #E4405F; margin-bottom: 12px;"></i>
                <h3 style="color: var(--legacy-navy); font-size: 2rem; margin-bottom: 4px;">{{ stats.conversas_instagram or 0 }}</h3>
                <p style="color: var(--gray-500); margin: 0;">Instagram</p>
            </div>
            
            <div style="text-align: center; padding: 24px; background: var(--gray-50); border-radius: 8px;">
                <i class="fas fa-globe" style="font-size: 3rem; color: var(--legacy-blue); margin-bottom: 12px;"></i>
                <h3 style="color: var(--legacy-navy); font-size: 2rem; margin-bottom: 4px;">{{ stats.conversas_webchat or 0 }}</h3>
                <p style="color: var(--gray-500); margin: 0;">WebChat</p>
            </div>
        </div>
    </div>
</div>

<!-- √öltimas Conversas -->
<div class="card">
    <div class="card-header">
        <h2>üí¨ √öltimas Conversas</h2>
        <p>Hist√≥rico recente de intera√ß√µes</p>
    </div>
    <div class="card-body">
        {% if stats.ultimas_conversas %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>Telefone</th>
                        <th>Canal</th>
                        <th>Mensagem</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for conv in stats.ultimas_conversas %}
                    <tr>
                        <td>{{ conv.timestamp_formatted }}</td>
                        <td>{{ conv.phone }}</td>
                        <td>
                            <span class="badge badge-info">{{ conv.canal }}</span>
                        </td>
                        <td>{{ conv.message[:80] }}{% if conv.message|length > 80 %}...{% endif %}</td>
                        <td>
                            {% if conv.role == 'user' %}
                            <span class="badge badge-success">Cliente</span>
                            {% else %}
                            <span class="badge badge-info">IA</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="color: var(--gray-500); text-align: center; padding: 32px;">
            Nenhuma conversa registrada ainda.
        </p>
        {% endif %}
    </div>
</div>

<!-- A√ß√µes R√°pidas -->
<div class="card">
    <div class="card-header">
        <h2>‚ö° A√ß√µes R√°pidas</h2>
        <p>Acesso r√°pido √†s principais funcionalidades</p>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
            <a href="/admin/treinamento" class="btn btn-primary" style="text-decoration: none;">
                <i class="fas fa-brain"></i> Treinar IA
            </a>
            <a href="/admin/controle" class="btn btn-secondary" style="text-decoration: none;">
                <i class="fas fa-toggle-on"></i> Controlar Bot
            </a>
            <a href="/admin/conversas" class="btn btn-outline" style="text-decoration: none;">
                <i class="fas fa-comments"></i> Ver Conversas
            </a>
            <a href="/admin/leads" class="btn btn-outline" style="text-decoration: none;">
                <i class="fas fa-users"></i> Gerenciar Leads
            </a>
        </div>
    </div>
</div>

{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// Auto-refresh a cada 30 segundos
setTimeout(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}
